/*!
 * JaffaMVC.js 0.0.9
 * (c) 2015 Rasmus KildevÃ¦ld, Softshag.
 * Inspired and based on Backbone.Marionette.js
 * (c) 2014 Derick Bailey, Muted Solutions, LLC.
 * (c) 2014 Adam Krebs, Jimmy Yuen Ho Wong
 * JaffaMVC may be freely distributed under the MIT license.
 */
!function(e,t){if("function"==typeof define&&define.amd)define(["backbone","co"],t);else if("object"==typeof exports){var i,n=null,r=null;try{n=require("exoskeleton")}catch(o){try{n=require("backbone")}catch(o){i=o}}try{r=require("co")}catch(o){}if(null===n)throw i;module.exports=t(n,r)}else e.JaffaMVC=t(e.Exoskeleton||e.Backbone,r)}(this,function(e,t){"use strict";function i(){return o.Debug===!0?"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments):void 0}function n(){var e=void 0===arguments[0]?{}:arguments[0];if(!e.selector)throw new Error("No selector specified",e);return r(e.selector,e.regionClass||j)}function r(e,t){var i=o.$(e);if(!i.length)throw new Error("Selector must exists in the dom");return new t({el:i[0]})}var o={};o.version="0.0.9",o.Debug=!1;var s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var i,n=[],r=e[Symbol.iterator]();!(i=r.next()).done&&(n.push(i.value),!t||n.length!==t););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function N(e,t,i){var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var r=Object.getPrototypeOf(e);return null===r?void 0:N(r,t,i)}if("value"in n&&n.writable)return n.value;var o=n.get;return void 0===o?void 0:o.call(i)},l=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},u=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.assign(o,{Events:e.Events,History:e.History,Model:e.Model,Collection:e.Collection,Router:e.Router});var h=function(e){function t(){c(this,t),null!=e&&e.apply(this,arguments)}return u(t,e),t}(Error),f=function(e){function t(){c(this,t),null!=e&&e.apply(this,arguments)}return u(t,e),t}(h),d=function(){var e=[],t=void 0,i=document,n=i.documentElement.doScroll,r="DOMContentLoaded",o=(n?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return o||i.addEventListener(r,t=function(){for(i.removeEventListener(r,t),o=1;t=e.shift();)t()}),function(t){o?t():e.push(t)}}();o.$=function(e,t){if("function"==typeof e)return d(e);if(t=t||document,"string"!=typeof e&&"nodeType"in e)return[e];if("string"==typeof t){if(t=document.querySelectorAll(t),!t.length)return t;var i=t,n=s(i,1);t=n[0]}return t.querySelectorAll(e)};var g=function(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})},p=Array.prototype.slice,v=Object.prototype.hasOwnProperty,b={callFunction:function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2]);case 4:return e.call(t,i[0],i[1],i[2],i[3]);default:return e.apply(t,i)}},callAsyncFunction:function(e,i,n){return new Promise(function(r,o){var s=void 0,a=void 0;if(s=function(e,t){return e?o(e):void r(t)},e.length>1)return e.call(i,n,s);if(b.isGenerator(e)||b.isGeneratorFunction(e)){if(!t||"function"!=typeof t.wrap)throw new Error("generators support needs co! - see https://github.com/tj/co");e=t.wrap(e)}try{a=e.call(i,n)}catch(l){a=l}a instanceof Error?o(a):a&&b.isPromise(a)?a.then(r,o):r(a)})},eachAsync:function(e,t,i){var n=0,r=e.length;return new Promise(function(o,s){var a=function(e){var t=function(){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(l){return null!=l||n===r?l?s(l):o():void b.callAsyncFunction(t,i,e[n++]).then(function(){a()},a)});a(null)})},bindAll:function(e,t){return b.proxy(e,e,t)},getOption:function(e){var t=this.options||{};return t[e]||this[e]},triggerMethod:function(e){var t=g("on-"+e.replace(/:/g,"-")),i=b.getOption.call(this,t),n=p.call(arguments,1);b.callFunction(this.trigger,this,p.call(arguments)),"function"==typeof i&&b.callFunction(i,this,n)},triggerMethodOn:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];b.callFunction(b.triggerMethod,e,i)},proxy:function(e,t,i){Array.isArray(i)||(i=[i]),i.forEach(function(i){"function"==typeof t[i]&&(e[i]=t[i].bind(t))})},isGenerator:function(e){return"function"==typeof e.next&&"function"==typeof e["throw"]},isGeneratorFunction:function(e){var t=e.constructor;return t?"GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName?!0:b.isGenerator(t.prototype):!1},isPromise:function(e){return"function"==typeof e.then},isObject:function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},result:function(e,t){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;i>r;r++)n[r-2]=arguments[r];return"function"==typeof e[t]?e[t].apply(e,n):e[t]}},y=function(){var e=function(){var e=void 0;if(null!=window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("msxml2.xmlhttp.6.0")}catch(t){e=t}try{return new ActiveXObject("msxml2.xmlhttp.3.0")}catch(t){e=t}try{return new ActiveXObject("msxml2.xmlhttp")}catch(t){e=t}return e},t=/^(?:application|text)\/xml/,i=/^application\/json/,n=function(e,n){return null==e&&(e=n.getResponseHeader("content-type")),t.test(e)?n.responseXML:i.test(e)&&""!==n.responseText?JSON.parse(n.responseText):n.responseText},r=function(e){return e.status>=200&&e.status<300||304===e.status||0===e.status&&"file:"===window.location.protocol},o=function(e,t,i,o){return function(){if(4===e.readyState){var s=e.status,a=n(t.headers&&t.headers.Accept,e);if(r(e))t.success&&t.success(a),i&&i(a);else{var l=new Error("Server responded with a status of "+s);t.error&&t.error(e,s,l),o&&o(e)}}}};return function(t){if(null==t||!b.isObject(t))throw new Error("no opts");t.type=(t.type||"GET").toUpperCase();var i=e();if(i instanceof Error)throw i;var n=void 0,r=void 0,s=new Promise(function(e,t){n=e,r=t});if(null==t.headers&&(t.headers={}),t.headers["X-Requested-With"]="XMLHttpRequest",t.contentType&&(t.headers["Content-Type"]=t.contentType),"GET"===t.type&&"object"==typeof t.data){var a="",l=function(e,t){return null==t?"":"&"+encodeURIComponent(e)+"="+encodeURIComponent(t)};for(var u in t.data)a+=l(u,t.data[u]);if(a){var c=-1===t.url.indexOf("?")?"?":"&";t.url+=c+a.substring(1)}}i.addEventListener("readystatechange",o(i,t,n,r)),"function"==typeof t.progress&&i.addEventListener("progress",t.progress),i.open(t.type,t.url,!0);var h="*/".concat("*"),f={"*":h,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};if(i.setRequestHeader("Accept",t.dataType&&f[t.dataType]?f[t.dataType]+("*"!==t.dataType?", "+h+"; q=0.01":""):f["*"]),t.headers)for(var d in t.headers)i.setRequestHeader(d,t.headers[d]);return t.beforeSend&&t.beforeSend(i),i.send(t.data),s}},m=function(){function e(){c(this,e),"function"==typeof this.initialize&&b.callFunction(this.initialize,this,arguments)}return l(e,null,{destroy:{value:function(){for(var e=arguments.length,t=Array(e),i=0;e>i;i++)t[i]=arguments[i];if(!this.isDestroyed)return this.triggerMethod("before:destroy",t),this._isDestroyed=!0,this.triggerMethod("destroy",t),this.stopListening(),this},writable:!0,configurable:!0},isDestroyed:{get:function(){return null==this._isDestroyed&&(this._isDestroyed=!1),this._isDestroyed},configurable:!0}}),e}();Object.assign(m.prototype,e.Events,{getOption:b.getOption,triggerMethod:b.triggerMethod});var w=function(){function e(){c(this,e),this._items=new Set}return l(e,null,{add:{value:function(e){return this._items.add(e),this},writable:!0,configurable:!0},"delete":{value:function(e){return this._items["delete"](e),this},writable:!0,configurable:!0},has:{value:function(e){return this._items.has(e)},writable:!0,configurable:!0},clear:{value:function(){return this._items.clear(),this},writable:!0,configurable:!0},find:{value:function(e,t){t=t||this;for(var i,n=this._items[Symbol.iterator]();!(i=n.next()).done;){var r=i.value;if(e.call(t,r)===!0)return r}return null},writable:!0,configurable:!0},size:{value:function(){return this._items.size},writable:!0,configurable:!0},onEach:{value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];return this.forEach(function(t){t[e]&&"function"==typeof t[e]&&b.callFunction(t[e],t,i)})},writable:!0,configurable:!0},forEach:{value:function(e,t){return this._items.forEach(e,t),this},writable:!0,configurable:!0}}),e}(),_=function(){function e(){c(this,e),this._phases=[],this._initialized=!1}return l(e,null,{phase:{value:function(e,t,i){"function"==typeof e&&(t=e,e=t.name||"unamed");var n={n:e,fn:t,ctx:i||this};return this._phases.push(n),this.isInitialized&&this._runPhase(n),this},writable:!0,configurable:!0},boot:{value:function(e){var t=this;if(this.isInitialized)throw new f("already initalized");var i=this._phases;return b.eachAsync(i,function(i){return t._runPhase(i,e)}).then(function(){t._initialized=!0})},writable:!0,configurable:!0},reset:{value:function(){return this._initialized=!1,this},writable:!0,configurable:!0},_runPhase:{value:function(e,t){return b.callAsyncFunction(e.fn,e.ctx,t)},writable:!0,configurable:!0},isInitialized:{get:function(){return this._initialized},configurable:!0}}),e}(),O=function(e){function t(){c(this,t),null!=e&&e.apply(this,arguments)}return u(t,e),t}(h),E={comply:function(e,t,i){this._cmds=this._cmds||{},this._cmds[e]={fn:t,ctx:i||this}},command:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;t>n;n++)i[n-1]=arguments[n];if(this._cmds=this._cmds||{},!this._cmds.hasOwnProperty(e))throw new O("no handler for command: ",e);var r=this._cmds[e],o=r.fn,s=r.ctx;b.callFunction(o,s,i)},stopComplying:function(e,t,i){this._cmds=this._cmds||{},i=i||this,delete this._cmds[e]}},x={reply:function(e,t,i){this._reqs=this._reqs||{},this._reqs[e]={fn:t,ctx:i||this}},request:function(e){if(this._reqs=this._reqs||{},this._reqs.hasOwnProperty(e)){var i=this._reqs[e],n=i.fn,r=i.ctx;(b.isGenerator(n)||b.isGeneratorFunction(n))&&(n=t.wrap(n));var o=n.apply(r,p.call(arguments,1));return o&&b.isPromise(o)?o:o=o instanceof Error?Promise.reject(o):Promise.resolve(o)}return Promise.reject(new O("no handler for request: "+e))},stopReplying:function(e,t,i){this._reqs=this._reqs||{},i=i||this,delete this._reqs[e]}},M=function(e){function t(e){c(this,t),this._name=e}return u(t,e),l(t,{Commands:{get:function(){return E},configurable:!0},Requests:{get:function(){return x},configurable:!0}},{extendObject:{value:function(e){o.utils.proxy(e,this,["comply","command","stopComplying","reply","request","stopReplying"])},writable:!0,configurable:!0}}),t}(m);Object.assign(M.prototype,E,x);var C=function(e){function t(e,i,n){c(this,t),Object.assign(this,{options:i,name:e,app:n}),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this)}return u(t,e),l(t,null,{startWithParent:{get:function(){return null==this._startWithParent&&(this._startWithParent=!0),this._startWithParent},set:function(e){this._startWithParent=e},configurable:!0},addInitializer:{value:function(e,t,i){this.initializer.phase(e,t,i||this)},writable:!0,configurable:!0},addFinalizer:{value:function(e,t,i){this.finalizer.phase(e,t,i||this)},writable:!0,configurable:!0},start:{value:function(e){var t=this;return this.initializer.isInitialized?Promise.resolve():(this.triggerMethod("before:start",e),this.initializer.boot(e).then(function(){return t._startSubmodules()}).then(function(){t.triggerMethod("start",e)}))},writable:!0,configurable:!0},stop:{value:function(e){var t=this;return this.isRunning?(this.triggerMethod("before:stop",e),this.finalizer.boot(e).then(function(){return t._stopSubmodules(e)}).then(function(){t.initializer.reset(),t.finalizer.reset(),t.triggerMethod("stop",e)})):Promise.resolve()},writable:!0,configurable:!0},module:{value:function(e,i){var n=void 0===arguments[2]?{}:arguments[2];if(null==i)return this.modules[e];if(this.modules.hasOwnProperty(e))throw new Error("Module already defined "+e);var r=i;return"function"!=typeof i&&(r=t.extend(i)),this.modules[e]=new r(e,n,this.app||this),this.modules[e]},writable:!0,configurable:!0},removeModule:{value:function(e){var t=this.module(e);t&&t.stop().then(function(){t.destroy()})},writable:!0,configurable:!0},removeAllModules:{value:function(){for(var e in this.modules)this.removeModule(e)},writable:!0,configurable:!0},destroy:{value:function(){this.removeAllModules(),a(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)},writable:!0,configurable:!0},initializer:{get:function(){return this._initializer||(this._initializer=new _),this._initializer},configurable:!0},finalizer:{get:function(){return this._finalizer||(this._finalizer=new _),this._finalizer},configurable:!0},modules:{get:function(){return null==this._modules&&(this._modules=[]),this._modules},configurable:!0},isRunning:{get:function(){return this.initializer.isInitialized&&!this.finalizer.isInitialized},configurable:!0},_startSubmodules:{value:function(e){var t=this;return b.eachAsync(Object.keys(this.modules),function(i){var n=t.modules[i];return n.startWithParent?n.start(e):void 0})},writable:!0,configurable:!0},_stopSubmodules:{value:function(){return b.eachAsync(this.modules,function(e){return e.stop()})},writable:!0,configurable:!0}}),t}(m),j=function(e){function t(){var e=void 0===arguments[0]?{}:arguments[0];c(this,t),this.options=e,this.el=this.getOption("el"),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this)}return u(t,e),l(t,{buildRegion:{value:function(e){return e instanceof t?e:"string"==typeof e?r(e,t):n(e)},writable:!0,configurable:!0}},{show:{value:function(e){var t=e!==this.currentView;return this.empty(),t&&(e.once("destroy",this.empty,this),e.once("render",function(){b.triggerMethodOn(e,"show")}),e.render(),b.triggerMethodOn(e,"before:show"),this._attachHtml(e),this.currentView=e),this},writable:!0,configurable:!0},destroy:{value:function(){this.empty(),this.stopListening()},writable:!0,configurable:!0},empty:{value:function(){if(this.currentView){var e=this.currentView;return e.off("destroy",this.empty,this),this.trigger("before:empty",e),this._destroyView(),this.trigger("empty",e),delete this.currentView,this}},writable:!0,configurable:!0},_attachHtml:{value:function(e){this.el.innerHtml="",this.el.appendChild(e.el)},writable:!0,configurable:!0},_destroyView:{value:function(){var e=this.currentView;e.destroy&&"function"==typeof e.destroy&&!e.isDestroyed?e.destroy():e.remove&&"function"==typeof e.remove&&e.remove()},writable:!0,configurable:!0}}),t}(m),R=["addRegions","addRegion","removeRegion","removeRegions"],P=function(e){function t(){c(this,t),this.regions={},a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this)}return u(t,e),l(t,null,{extendObject:{value:function(e){b.proxy(e,this,R),e.regions=this.regions},writable:!0,configurable:!0},unproxyObject:{value:function(e){R.forEach(function(t){e[t]&&delete e[t]})},writable:!0,configurable:!0},addRegions:{value:function(e){var t=void 0,i={},n=Object.keys(e);return n.forEach(function(n){t=e[n],i[n]=this.addRegion(n,t)},this),i},writable:!0,configurable:!0},addRegion:{value:function(e,t){var i=o.Region.buildRegion(t);return this._setRegion(e,i),i},writable:!0,configurable:!0},removeRegion:{value:function(){var e=p.call(arguments);e.forEach(function(e){if(v.call(this.regions,e)){var t=this.regions[e];t.destroy(),this._unsetRegion(e)}},this)},writable:!0,configurable:!0},destroy:{value:function(){a(Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.removeRegions()},writable:!0,configurable:!0},removeRegions:{value:function(){this.removeRegion.apply(this,Object.keys(this.regions))},writable:!0,configurable:!0},_setRegion:{value:function(e,t){this.regions[e]=t},writable:!0,configurable:!0},_unsetRegion:{value:function(e){delete this.regions[e]},writable:!0,configurable:!0}}),t}(m),S=/^\s*</,z="undefined"!=typeof Element&&Element.prototype||{},T=z.addEventListener||function(e,t){return this.attachEvent("on"+e,t)},A=z.removeEventListener||function(e,t){return this.detachEvent("on"+e,t)},V=function(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},q=z.matches||z.webkitMatchesSelector||z.mozMatchesSelector||z.msMatchesSelector||z.oMatchesSelector||function(e){var t=(this.parentNode||document).querySelectorAll(e)||[];return!!~V(t,this)},L=e.View,D=function(e){function t(){for(var e=arguments.length,i=Array(e),n=0;e>n;n++)i[n]=arguments[n];c(this,t),this._domEvents=[],a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,i)}return u(t,e),l(t,null,{$:{value:function(e){return o.$(e,this.el)},writable:!0,configurable:!0},_removeElement:{value:function(){this.undelegateEvents(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},writable:!0,configurable:!0},_setElement:{value:function(e){if("string"==typeof e)if(S.test(e)){var t=document.createElement("div");t.innerHTML=e,this.el=t.firstChild}else this.el=document.querySelector(e);else this.el=e;this.$el=o.$(this.el)},writable:!0,configurable:!0},_setAttributes:{value:function(e){for(var t in e)t in this.el?this.el[t]=e[t]:this.el.setAttribute(t,e[t])},writable:!0,configurable:!0},delegate:{value:function(e,t,i){"function"==typeof t&&(i=t,t=null);var n=this.el,r=t?function(e){for(var r=e.target||e.srcElement;r&&r!=n;r=r.parentNode)q.call(r,t)&&(e.delegateTarget=r,i(e))}:i;return T.call(this.el,e,r,!1),this._domEvents.push({eventName:e,handler:r,listener:i,selector:t}),r},writable:!0,configurable:!0},undelegate:{value:function(e,t,i){if("function"==typeof t&&(i=t,t=null),this.el)for(var n=this._domEvents.slice(),r=0,o=n.length;o>r;r++){var s=n[r],a=s.eventName===e&&(i?s.listener===i:!0)&&(t?s.selector===t:!0);a&&(A.call(this.el,s.eventName,s.handler,!1),this._domEvents.splice(V(n,s),1))}return this},writable:!0,configurable:!0},undelegateEvents:{value:function(){if(this.el){for(var e=0,t=this._domEvents.length;t>e;e++){var i=this._domEvents[e];A.call(this.el,i.eventName,i.handler,!1)}this._domEvents.length=0}return this},writable:!0,configurable:!0}}),t}(L),F=function(e){function t(e){c(this,t),this.options=e||{},this.isDestroyed=!1,this.listenTo(this,"show",function(){this._isShown=!0}),this.listenTo(this,"render",function(){this._isRendered=!0}),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return u(t,e),l(t,null,{isShown:{get:function(){return!!this._isShown},configurable:!0},isRendered:{get:function(){return!!this._isRendered},configurable:!0},destroy:{value:function(){if(this.isDestroyed===!0)return this;var e=p.call(arguments);return this.triggerMethod("before:destroy",e),this.isDestroyed=!0,this.triggerMethod("destroy",e),i("view destroy:",this),this.remove(),this},writable:!0,configurable:!0},render:{value:function(){var e=this;this.triggerMethod("before:render",this),this.undelegateEvents();var t=this.getOption("template");return null!=t?this._renderTemplate(t).then(function(t){e.el.innerHTML=t,e.delegateEvents(),e.triggerMethod("render",e)}):(this.delegateEvents(),this.triggerMethod("render",this)),this},writable:!0,configurable:!0},getTemplateData:{value:function(){return this.model?this.model.toJSON():{}},writable:!0,configurable:!0},delegateEvents:{value:function(e){this.bindUIElements();var i=e||this.events;i=this.normalizeUIKeys(i);var n=this._configureTriggers(),r={};Object.assign(r,i,n),a(Object.getPrototypeOf(t.prototype),"delegateEvents",this).call(this,r)},writable:!0,configurable:!0},undelegateEvents:{value:function(){this.unbindUIElements(),a(Object.getPrototypeOf(t.prototype),"undelegateEvents",this).call(this)},writable:!0,configurable:!0},_configureTriggers:{value:function(){if(!this.triggers)return{};var e=this.normalizeUIKeys(b.result(this,"triggers")),t={},i=void 0,n=void 0;for(n in e)i=e[n],t[n]=this._buildViewTrigger(i);return t},writable:!0,configurable:!0},_buildViewTrigger:{value:function(e){"string"==typeof e&&(e={event:e});var t=Object.assign({preventDefault:!0,stopPropagation:!0},e);return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation()),this.triggerMethod(t.event,{view:this,model:this.model,collection:this.collection})}},writable:!0,configurable:!0},bindUIElements:{value:function(){var e=this,t=this.getOption("ui");t&&(this._ui||(this._ui=t),t=o.utils.result(this,"_ui"),this.ui={},Object.keys(t).forEach(function(i){var n=e.$(t[i]);n&&n.length&&(n instanceof NodeList&&(n=n[0]),e.ui[i]=n)}),this.ui=this.ui)},writable:!0,configurable:!0},unbindUIElements:{value:function(){},writable:!0,configurable:!0},_renderTemplate:{value:function(e){var t=this.getOption("getTemplateData").call(this);return"function"==typeof e?b.callAsyncFunction(e,this,t):Promise.resolve(e)},writable:!0,configurable:!0},normalizeUIKeys:{value:function(e){var t=/@ui.([a-zA-Z_\-\$#]+)/i,i={},n=void 0,r=void 0,o=void 0,s=void 0,a=void 0;for(n in e)r=e[n],null!==(o=t.exec(n))&&(a=o[1],s=this._ui[a],null!=s&&(n=n.replace(o[0],s))),i[n]=r;return i},writable:!0,configurable:!0}}),t}(D);Object.assign(F.prototype,{getOption:b.getOption,triggerMethod:b.triggerMethod});var I=function(e){function t(e){c(this,t),this.options=e||{};var i=this.getOption("regions");this._regionManager=new P,b.proxy(this,this._regionManager,["removeRegion","removeRegions"]),this.regions=this._regionManager.regions,this.options=e||{},this.listenTo(this,"render",function(){this.addRegions(i)}),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}return u(t,e),l(t,null,{addRegion:{value:function(e,t){if("string"==typeof t){var i=this.$(t);if(!i.length)throw new Error("element must exists in dom");t=new o.Region({el:i[0]})}this._regionManager.addRegion(e,t)},writable:!0,configurable:!0},addRegions:{value:function(e){for(var t in e)this.addRegion(t,e[t])},writable:!0,configurable:!0},destroy:{value:function(){a(Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this._regionManager.destroy()},writable:!0,configurable:!0}}),t}(F),B=function(e){function t(e){c(this,t),this.children=new w,this._isBuffering=!1,b.bindAll(this,["render"]),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.sort=!0,this.once("render",this._initCollectionEvents),this.listenTo(this,"before:show",function(){this.children.forEach(function(e){e.isShown||b.triggerMethodOn(e,"before:show")})}),this.listenTo(this,"show",function(){this.children.forEach(function(e){e.isShown||b.triggerMethodOn(e,"show")})})}return u(t,e),l(t,null,{render:{value:function(e){return this.destroyChildren(),this._destroyContainer(),this.listenToOnce(this,"render",function(){this._initContainer(),this.collection&&this._renderChildren(this.collection.models),"function"==typeof e&&e()}),a(Object.getPrototypeOf(t.prototype),"render",this).call(this)},writable:!0,configurable:!0},renderCollection:{value:function(){var e=this,t=void 0;this.trigger("before:render:children"),this.collection.models.forEach(function(i,n){t=e._getChildView(i),e._addChildView(t,n)}),this.trigger("render:children")},writable:!0,configurable:!0},renderChildView:{value:function(e,t){this.triggerMethod("before:render:child",e),e.render(),this._attachHTML(e,t),this.triggerMethod("render:child",e)},writable:!0,configurable:!0},removeChildView:{value:function(e){e&&("function"==typeof e.destroy?e.destroy():"function"==typeof e.remove&&e.remove(),this.stopListening(e),this.children["delete"](e),this._updateIndexes(e,!1))},writable:!0,configurable:!0},startBuffering:{value:function(){this._buffer=document.createDocumentFragment(),this._isBuffering=!0,this._bufferedChildren=[]},writable:!0,configurable:!0},stopBuffering:{value:function(){this._isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this._container.appendChild(this._buffer),this._triggerShowBufferedChildren(),delete this._bufferedChildren},writable:!0,configurable:!0},_triggerBeforeShowBufferedChildren:{value:function(){this._isShown&&this._bufferedChildren.forEach(function(e){e._isShown||b.triggerMethodOn(e,"before:show")})},writable:!0,configurable:!0},_triggerShowBufferedChildren:{value:function(){this._isShown&&this._bufferedChildren.forEach(function(e){e._isShown||b.triggerMethodOn(e,"show")})},writable:!0,configurable:!0},_getChildView:{value:function(e){var t=this.getOption("childView")||o.View,i=this.getOption("childViewOptions")||{};return new t(Object.assign({model:e},i))},writable:!0,configurable:!0},_attachHTML:{value:function(e,t){this._isBuffering?(this._buffer.appendChild(e.el),this._bufferedChildren.push(e)):(this._isShown&&b.triggerMethodOn(e,"before:show"),this._insertBefore(e,t)||this._insertAfter(e),this._isShown&&b.triggerMethodOn(e,"show"))},writable:!0,configurable:!0},_renderChildren:{value:function(){this.destroyChildren(),0!==this.collection.length&&(this.startBuffering(),this.renderCollection(),this.stopBuffering())},writable:!0,configurable:!0},_addChildView:{value:function(e,t){this._updateIndexes(e,!0,t),this.proxyChildViewEvents(e),this.children.add(e),this.renderChildView(e,t),this.triggerMethod("add:child",e)},writable:!0,configurable:!0},proxyChildViewEvents:{value:function(e){var t=this.getOption("prefix")||"childview";this.listenTo(e,"all",function(){var i=p.call(arguments);i[0]=t+":"+i[0],i.splice(1,0,e),b.callFunction(this.triggerMethod,this,i)})},writable:!0,configurable:!0},resortView:{value:function(){var e=this;return this.triggerMethod("before:resort"),this.render(function(){e.triggerMethod("resort")}),this},writable:!0,configurable:!0},destroy:{value:function(){return this.triggerMethod("before:destroy:children"),this.destroyChildren(),this.triggerMethod("destroy:children"),a(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)},writable:!0,configurable:!0},destroyChildren:{value:function(){this._container&&(this._container.innerHtml=""),0!==this.children.size&&(this.children.forEach(this.removeChildView,this),this.children.clear())},writable:!0,configurable:!0},_insertBefore:{value:function(e,t){var i=void 0,n=this.sort&&t<this.children.size-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(this._container.insertBefore(e.el,i.el),!0):!1},writable:!0,configurable:!0},_insertAfter:{value:function(e){this._container.appendChild(e.el)},writable:!0,configurable:!0},_destroyContainer:{value:function(){this._container&&delete this._container},writable:!0,configurable:!0},_initCollectionEvents:{value:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._onCollectionSort))},writable:!0,configurable:!0},_initContainer:{value:function(){var e=this.getOption("childViewContainer");e=e?this.$(e)[0]:this.el,this._container=e},writable:!0,configurable:!0},_updateIndexes:{value:function(e,t,i){this.sort&&(t?(e._index=i,this.children.forEach(function(t){t._index>=e._index&&t._index++})):this.children.forEach(function(t){t._index>=e._index&&t._index--}))},writable:!0,configurable:!0},_onCollectionAdd:{value:function(e){var t=this._getChildView(e),i=this.collection.models.indexOf(e);this._addChildView(t,i)},writable:!0,configurable:!0},_onCollectionRemove:{value:function(e){var t=this.children.find(function(t){return t.model===e});this.removeChildView(t)},writable:!0,configurable:!0},_onCollectionSort:{value:function(){var e=this,t=this.collection.find(function(t,i){var n=e.children.find(function(e){return e.model===t});return!n||n._index!==i});t&&this.resortView()},writable:!0,configurable:!0}}),t}(F),H=function(t){function i(){var e=void 0===arguments[0]?{}:arguments[0];c(this,i),this.options=e;var t=this.getOption("regions");this._regionManager=new P,this._regionManager.extendObject(this),t&&this._regionManager.addRegions(t),this.channels={},this.channel("global").extendObject(this),"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}return u(i,t),l(i,null,{channel:{value:function n(e){if(this.channels[e])return this.channels[e];var n=new o.Channel(e);return this.channels[e]=n,n},writable:!0,configurable:!0},startHistory:{value:function(t){if(!this.isRunning)throw new Error("app not started");e.history&&(this.trigger("before:history:start",t),e.history.start(t),this.trigger("history:start",t))},writable:!0,configurable:!0},stopHistory:{value:function(){return e.history&&(this.trigger("before:history:stop"),e.history.stop(),this.trigger("history:stop")),this},writable:!0,configurable:!0},navigate:{value:function(t,i){e.history.navigate(t,i)},writable:!0,configurable:!0},currentFragment:{value:function(){return e.history.fragment},writable:!0,configurable:!0},destroy:{value:function(){a(Object.getPrototypeOf(i.prototype),"destroy",this).call(this),this.channels.forEach(function(e){e.destroy()}),delete this.channels,this._regionManager.unproxyObject(this),this._regionManager.destroy(),delete this._regionManager},writable:!0,configurable:!0}}),i}(C);return H.extend=F.extend=B.extend=I.extend=j.extend=P.extend=C.extend=m.extend=e.extend,e.ajax=y(),Object.assign(o,{Application:H,Module:C,RegionManager:P,Region:j,LayoutView:I,View:F,CollectionView:B,Channel:M,List:w,Object:m,utils:b,NativeView:D}),o});