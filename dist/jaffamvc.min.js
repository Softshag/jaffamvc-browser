/*!
 * JaffaMVC.js 0.0.3
 * (c) 2015 Rasmus KildevÃ¦ld, Softshag.
 * Inspired and based on Backbone.Marionette.js
 * (c) 2014 Derick Bailey, Muted Solutions, LLC.
 * (c) 2014 Adam Krebs, Jimmy Yuen Ho Wong
 * JaffaMVC may be freely distributed under the MIT license.
 */
!function(t,e){if("function"==typeof define&&define.amd)define(["backbone","co"],e);else if("object"==typeof exports){var i,n=null,r=null;try{n=require("exoskeleton")}catch(o){try{n=require("backbone")}catch(o){i=o}}try{r=require("co")}catch(o){}if(null===n)throw i;module.exports=e(n,r)}else t.JaffaMVC=e(t.Exoskeleton||t.Backbone,r)}(this,function(t,e){"use strict";function i(){var t=void 0===arguments[0]?{}:arguments[0];if(!t.selector)throw new Error("No selector specified",t);return n(t.selector,t.regionClass||M)}function n(t,e){var i=r.$(t);if(!i.length)throw new Error("Selector must exists in the dom");return new e({el:i[0]})}var r={};r.version="0.0.3";var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var i,n=[],r=t[Symbol.iterator]();!(i=r.next()).done&&(n.push(i.value),!e||n.length!==e););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=function H(t,e,i){var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:H(r,e,i)}if("value"in n&&n.writable)return n.value;var o=n.get;return void 0===o?void 0:o.call(i)},a=function(t,e,i){e&&Object.defineProperties(t,e),i&&Object.defineProperties(t.prototype,i)},l=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};Object.assign(r,{Events:t.Events,History:t.History,Model:t.Model,Collection:t.Collection,Router:t.Router});var c=function(t){function e(){u(this,e),null!=t&&t.apply(this,arguments)}return l(e,t),e}(Error),h=function(t){function e(){u(this,e),null!=t&&t.apply(this,arguments)}return l(e,t),e}(c),f=function(){var t=[],e=void 0,i=document,n=i.documentElement.doScroll,r="DOMContentLoaded",o=(n?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return o||i.addEventListener(r,e=function(){for(i.removeEventListener(r,e),o=1;e=t.shift();)e()}),function(e){o?e():t.push(e)}}();r.$=function(t,e){if("function"==typeof t)return f(t);if(e=e||document,"string"!=typeof t&&"nodeType"in t)return[t];if("string"==typeof e){if(e=document.querySelectorAll(e),!e.length)return e;var i=e,n=o(i,1);e=n[0]}return e.querySelectorAll(t)};var d=function(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})},g=Array.prototype.slice,p={callFunction:function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2]);case 4:return t.call(e,i[0],i[1],i[2],i[3]);default:return t.apply(e,i)}},callAsyncFunction:function(t,i,n){return new Promise(function(r,o){var s=void 0,a=void 0;if(s=function(t,e){return t?o(t):void r(e)},t.length>1)return t.call(i,n,s);if(p.isGenerator(t)||p.isGeneratorFunction(t)){if(!e||"function"!=typeof e.wrap)throw new Error("generators support needs co! - see https://github.com/tj/co");t=e.wrap(t)}try{a=t.call(i,n)}catch(l){a=l}a instanceof Error?o(a):a&&p.isPromise(a)?a.then(r,o):r(a)})},eachAsync:function(t,e,i){var n=0,r=t.length;return new Promise(function(o,s){var a=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(l){return null!=l||n===r?l?s(l):o():void p.callAsyncFunction(e,i,t[n++]).then(function(){a()},a)});a(null)})},bindAll:function(t,e){return p.proxy(t,t,e)},getOption:function(t){var e=this.options||{};return e[t]||this[t]},triggerMethod:function(t){var e=d("on-"+t.replace(/:/,"-")),i=p.getOption.call(this,e),n=g.call(arguments,1);p.callFunction(this.trigger,this,g.call(arguments)),"function"==typeof i&&p.callFunction(i,this,n)},triggerMethodOn:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];p.callFunction(p.triggerMethod,t,i)},proxy:function(t,e,i){Array.isArray(i)||(i=[i]),i.forEach(function(i){"function"==typeof e[i]&&(t[i]=e[i].bind(e))})},isGenerator:function(t){return"function"==typeof t.next&&"function"==typeof t["throw"]},isGeneratorFunction:function(t){var e=t.constructor;return e?"GeneratorFunction"===e.name||"GeneratorFunction"===e.displayName?!0:p.isGenerator(e.prototype):!1},isPromise:function(t){return"function"==typeof t.then},isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},result:function(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;i>r;r++)n[r-2]=arguments[r];return"function"==typeof t[e]?t[e].apply(t,n):t[e]}},v=function(){var t=function(){var t=void 0;if(null!=window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("msxml2.xmlhttp.6.0")}catch(e){t=e}try{return new ActiveXObject("msxml2.xmlhttp.3.0")}catch(e){t=e}try{return new ActiveXObject("msxml2.xmlhttp")}catch(e){t=e}return t},e=/^(?:application|text)\/xml/,i=/^application\/json/,n=function(t,n){return null==t&&(t=n.getResponseHeader("content-type")),e.test(t)?n.responseXML:i.test(t)&&""!==n.responseText?JSON.parse(n.responseText):n.responseText},r=function(t){return t.status>=200&&t.status<300||304===t.status||0===t.status&&"file:"===window.location.protocol},o=function(t,e,i,o){return function(){if(4===t.readyState){var s=t.status,a=n(e.headers&&e.headers.Accept,t);if(r(t))e.success&&e.success(a),i&&i(a);else{var l=new Error("Server responded with a status of "+s);e.error&&e.error(t,s,l),o&&o(t)}}}};return function(e){if(null==e||!p.isObject(e))throw new Error("no opts");e.type=(e.type||"GET").toUpperCase();var i=t();if(i instanceof Error)throw i;var n=void 0,r=void 0,s=new Promise(function(t,e){n=t,r=e});if(e.contentType&&(null==e.headers&&(e.headers={}),e.headers["Content-Type"]=e.contentType),"GET"===e.type&&"object"==typeof e.data){var a="",l=function(t,e){return null==e?"":"&"+encodeURIComponent(t)+"="+encodeURIComponent(e)};for(var u in e.data)a+=l(u,e.data[u]);if(a){var c=-1===e.url.indexOf("?")?"?":"&";e.url+=c+a.substring(1)}}i.addEventListener("readystatechange",o(i,e,n,r)),"function"==typeof e.progress&&i.addEventListener("progress",e.progress),i.open(e.type,e.url,!0);var h="*/".concat("*"),f={"*":h,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"};if(i.setRequestHeader("Accept",e.dataType&&f[e.dataType]?f[e.dataType]+("*"!==e.dataType?", "+h+"; q=0.01":""):f["*"]),e.headers)for(var d in e.headers)i.setRequestHeader(d,e.headers[d]);return e.beforeSend&&e.beforeSend(i),i.send(e.data),s}},b=function(){function t(){u(this,t),"function"==typeof this.initialize&&p.callFunction(this.initialize,this,arguments)}return a(t,null,{destroy:{value:function(){for(var t=arguments.length,e=Array(t),i=0;t>i;i++)e[i]=arguments[i];if(!this.isDestroyed)return this.triggerMethod("before:destroy",e),this._isDestroyed=!0,this.triggerMethod("destroy",e),this.stopListening(),this},writable:!0,configurable:!0},isDestroyed:{get:function(){return null==this._isDestroyed&&(this._isDestroyed=!1),this._isDestroyed},configurable:!0}}),t}();Object.assign(b.prototype,t.Events,{getOption:p.getOption,triggerMethod:p.triggerMethod});var y=function(){function t(){var e=void 0===arguments[0]?{}:arguments[0];u(this,t),this.options=e,this._items=[],this.length=0,this.onRemove=e.onRemove||this.onRemove,this.onAdd=e.onAdd||this.onAdd}return a(t,null,{has:{value:function(t){return~this._items.indexOf(t)},writable:!0,configurable:!0},add:{value:function(t){this.has(t)||(this._items.push(t),this._updateLength.call(this),this.onAdd&&this.onAdd(t))},writable:!0,configurable:!0},remove:{value:function(t){this.has(t)&&(this._items.splice(this._items.indexOf(t),1),this._updateLength.call(this),this.onRemove&&this.onRemove(t))},writable:!0,configurable:!0},empty:{value:function(){this.forEach(this.remove,this),this._items=[],this._updateLength.call(this)},writable:!0,configurable:!0},find:{value:function(t,e){for(var i=void 0,n=0;n<this._items.length;n++)if(i=this._items[n],t.call(e,i)===!0)return i;return null},writable:!0,configurable:!0},forEach:{value:function(t,e){return this._items.forEach(t,e)},writable:!0,configurable:!0},_updateLength:{value:function(){this.length=this._items.length},writable:!0,configurable:!0}}),t}(),m=function(){function t(){u(this,t),this._phases=[],this._initialized=!1}return a(t,null,{phase:{value:function(t,e,i){"function"==typeof t&&(e=t,t=e.name||"unamed");var n={n:t,fn:e,ctx:i||this};return this._phases.push(n),this.isInitialized&&this._runPhase(n),this},writable:!0,configurable:!0},boot:{value:function(t){var e=this;if(this.isInitialized)throw new h("already initalized");var i=this._phases;return p.eachAsync(i,function(i){return e._runPhase(i,t)}).then(function(){e._initialized=!0})},writable:!0,configurable:!0},reset:{value:function(){return this._initialized=!1,this},writable:!0,configurable:!0},_runPhase:{value:function(t,e){return p.callAsyncFunction(t.fn,t.ctx,e)},writable:!0,configurable:!0},isInitialized:{get:function(){return this._initialized},configurable:!0}}),t}(),w=function(t){function e(){u(this,e),null!=t&&t.apply(this,arguments)}return l(e,t),e}(c),_={comply:function(t,e,i){this._cmds=this._cmds||{},this._cmds[t]={fn:e,ctx:i||this}},command:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];if(this._cmds=this._cmds||{},!this._cmds.hasOwnProperty(t))throw new w("no handler for command: ",t);var r=this._cmds[t],o=r.fn,s=r.ctx;p.callFunction(o,s,i)},stopComplying:function(t,e,i){this._cmds=this._cmds||{},i=i||this,delete this._cmds[t]}},O={reply:function(t,e,i){this._reqs=this._reqs||{},this._reqs[t]={fn:e,ctx:i||this}},request:function(t){if(this._reqs=this._reqs||{},this._reqs.hasOwnProperty(t)){var i=this._reqs[t],n=i.fn,r=i.ctx;(p.isGenerator(n)||p.isGeneratorFunction(n))&&(n=e.wrap(n));var o=n.apply(r,g.call(arguments,1));return p.isPromise(o)?o:o=o instanceof Error?Promise.reject(o):Promise.resolve(o)}return Promise.reject(new w("no handler for request: "+t))},stopReplying:function(t,e,i){this._reqs=this._reqs||{},i=i||this,delete this._reqs[t]}},x=function(t){function e(t){u(this,e),this._name=t}return l(e,t),a(e,{Commands:{get:function(){return _},configurable:!0},Requests:{get:function(){return O},configurable:!0}},{extendObject:{value:function(t){r.utils.proxy(t,this,["comply","command","stopComplying","reply","request","stopReplying"])},writable:!0,configurable:!0}}),e}(b);Object.assign(x.prototype,_,O);var E=function(t){function e(t,i,n){u(this,e),Object.assign(this,{options:i,name:t,app:n}),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this)}return l(e,t),a(e,null,{startWithParent:{get:function(){return null==this._startWithParent&&(this._startWithParent=!0),this._startWithParent},set:function(t){this._startWithParent=t},configurable:!0},addInitializer:{value:function(t,e,i){this.initializer.phase(t,e,i||this)},writable:!0,configurable:!0},addFinalizer:{value:function(t,e,i){this.finalizer.phase(t,e,i||this)},writable:!0,configurable:!0},start:{value:function(t){var e=this;return this.initializer.isInitialized?Promise.resolve():(this.triggerMethod("before:start",t),this.initializer.boot(t).then(function(){return e._startSubmodules()}).then(function(){e.triggerMethod("start",t)}))},writable:!0,configurable:!0},stop:{value:function(t){var e=this;return this.isRunning?(this.triggerMethod("before:stop",t),this.finalizer.boot(t).then(function(){return e._stopSubmodules(t)}).then(function(){e.initializer.reset(),e.finalizer.reset(),e.triggerMethod("stop",t)})):Promise.resolve()},writable:!0,configurable:!0},module:{value:function(t,i){var n=void 0===arguments[2]?{}:arguments[2];if(null==i)return this.modules[t];if(this.modules.hasOwnProperty(t))throw new Error("Module already defined "+t);var r=i;return"function"!=typeof i&&(r=e.extend(i)),this.modules[t]=new r(t,n,this.app||this),this.modules[t]},writable:!0,configurable:!0},removeModule:{value:function(t){var e=this.module(t);e&&e.stop().then(function(){e.destroy()})},writable:!0,configurable:!0},removeAllModules:{value:function(){for(var t in this.modules)this.removeModule(t)},writable:!0,configurable:!0},destroy:{value:function(){this.removeAllModules(),s(Object.getPrototypeOf(e.prototype),"destroy",this).call(this)},writable:!0,configurable:!0},initializer:{get:function(){return this._initializer||(this._initializer=new m),this._initializer},configurable:!0},finalizer:{get:function(){return this._finalizer||(this._finalizer=new m),this._finalizer},configurable:!0},modules:{get:function(){return null==this._modules&&(this._modules=[]),this._modules},configurable:!0},isRunning:{get:function(){return this.initializer.isInitialized&&!this.finalizer.isInitialized},configurable:!0},_startSubmodules:{value:function(t){var e=this;return p.eachAsync(Object.keys(this.modules),function(i){var n=e.modules[i];return n.startWithParent?n.start(t):void 0})},writable:!0,configurable:!0},_stopSubmodules:{value:function(){return p.eachAsync(this.modules,function(t){return t.stop()})},writable:!0,configurable:!0}}),e}(b),M=function(t){function e(){var t=void 0===arguments[0]?{}:arguments[0];u(this,e),this.options=t,this.el=this.getOption("el"),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this)}return l(e,t),a(e,{buildRegion:{value:function(t){return t instanceof e?t:"string"==typeof t?n(t,e):i(t)},writable:!0,configurable:!0}},{show:{value:function(t){var e=t!==this.currentView;return this.empty(),e&&(t.once("destroy",this.empty,this),t.render(),p.triggerMethodOn(t,"before:show"),this._attachHtml(t),this.currentView=t,p.triggerMethodOn(t,"show")),this},writable:!0,configurable:!0},destroy:{value:function(){this.empty(),this.stopListening()},writable:!0,configurable:!0},empty:{value:function(){if(this.currentView){var t=this.currentView;return t.off("destroy",this.empty,this),this.trigger("before:empty",t),this._destroyView(),this.trigger("empty",t),delete this.currentView,this}},writable:!0,configurable:!0},_attachHtml:{value:function(t){this.el.innerHtml="",this.el.appendChild(t.el)},writable:!0,configurable:!0},_destroyView:{value:function(){var t=this.currentView;t.destroy&&"function"==typeof t.destroy&&!t.isDestroyed?t.destroy():t.remove&&"function"==typeof t.remove&&t.remove()},writable:!0,configurable:!0}}),e}(b),C=["addRegions","addRegion","removeRegion","removeRegions"],j=function(t){function e(){u(this,e),this.regions={},s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this)}return l(e,t),a(e,null,{extendObject:{value:function(t){p.proxy(t,this,C),t.regions=this.regions},writable:!0,configurable:!0},unproxyObject:{value:function(t){C.forEach(function(e){t[e]&&delete t[e]})},writable:!0,configurable:!0},addRegions:{value:function(t){var e=void 0,i={},n=Object.keys(t);return n.forEach(function(n){e=t[n],i[n]=this.addRegion(n,e)},this),i},writable:!0,configurable:!0},addRegion:{value:function(t,e){var i=r.Region.buildRegion(e);return this._setRegion(t,i),i},writable:!0,configurable:!0},removeRegion:{value:function(){var t=g.call(arguments);t.forEach(function(t){if(__has.call(this.regions,t)){var e=this.regions[t];e.destroy(),this._unsetRegion(t)}},this)},writable:!0,configurable:!0},destroy:{value:function(){s(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.removeRegions()},writable:!0,configurable:!0},removeRegions:{value:function(){this.removeRegion.apply(this,Object.keys(this.regions))},writable:!0,configurable:!0},_setRegion:{value:function(t,e){this.regions[t]=e},writable:!0,configurable:!0},_unsetRegion:{value:function(t){delete this.regions[t]},writable:!0,configurable:!0}}),e}(b),R=/^\s*</,P="undefined"!=typeof Element&&Element.prototype||{},A=P.addEventListener||function(t,e){return this.attachEvent("on"+t,e)},z=P.removeEventListener||function(t,e){return this.detachEvent("on"+t,e)},T=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},V=P.matches||P.webkitMatchesSelector||P.mozMatchesSelector||P.msMatchesSelector||P.oMatchesSelector||function(t){var e=(this.parentNode||document).querySelectorAll(t)||[];return!!~T(e,this)},S=t.View,q=function(t){function e(){for(var t=arguments.length,i=Array(t),n=0;t>n;n++)i[n]=arguments[n];u(this,e),this._domEvents=[],s(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,i)}return l(e,t),a(e,null,{$:{value:function(t){return r.$(t,this.el)},writable:!0,configurable:!0},_removeElement:{value:function(){this.undelegateEvents(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},writable:!0,configurable:!0},_setElement:{value:function(t){if("string"==typeof t)if(R.test(t)){var e=document.createElement("div");e.innerHTML=t,this.el=e.firstChild}else this.el=document.querySelector(t);else this.el=t;this.$el=r.$(this.el)},writable:!0,configurable:!0},_setAttributes:{value:function(t){for(var e in t)e in this.el?this.el[e]=t[e]:this.el.setAttribute(e,t[e])},writable:!0,configurable:!0},delegate:{value:function(t,e,i){"function"==typeof e&&(i=e,e=null);var n=this.el,r=e?function(t){for(var r=t.target||t.srcElement;r&&r!=n;r=r.parentNode)V.call(r,e)&&(t.delegateTarget=r,i(t))}:i;return A.call(this.el,t,r,!1),this._domEvents.push({eventName:t,handler:r,listener:i,selector:e}),r},writable:!0,configurable:!0},undelegate:{value:function(t,e,i){if("function"==typeof e&&(i=e,e=null),this.el)for(var n=this._domEvents.slice(),r=0,o=n.length;o>r;r++){var s=n[r],a=s.eventName===t&&(i?s.listener===i:!0)&&(e?s.selector===e:!0);a&&(z.call(this.el,s.eventName,s.handler,!1),this._domEvents.splice(T(n,s),1))}return this},writable:!0,configurable:!0},undelegateEvents:{value:function(){if(this.el){for(var t=0,e=this._domEvents.length;e>t;t++){var i=this._domEvents[t];z.call(this.el,i.eventName,i.handler,!1)}this._domEvents.length=0}return this},writable:!0,configurable:!0}}),e}(S),L=function(t){function e(t){u(this,e),this.options=t||{},this.isDestroyed=!1,this.listenTo(this,"show",function(){this._isShown=!0}),this.listenTo(this,"render",function(){this._isRendered=!0}),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return l(e,t),a(e,null,{destroy:{value:function(){if(this.isDestroyed===!0)return this;var t=g.call(arguments);return this.triggerMethod("before:destroy",t),this.isDestroyed=!0,this.triggerMethod("destroy",t),this.remove(),this},writable:!0,configurable:!0},render:{value:function(){var t=this;this.triggerMethod("before:render",this),this.undelegateEvents();var e=this.getOption("template");return e?this._renderTemplate(e).then(function(e){t.el.innerHTML=e,t.delegateEvents(),t.triggerMethod("render",t)}):(this.delegateEvents(),this.triggerMethod("render",this)),this},writable:!0,configurable:!0},getTemplateData:{value:function(){return this.model?this.model.toJSON():{}},writable:!0,configurable:!0},delegateEvents:{value:function(t){this.bindUIElements();var i=t||this.events;i=this.normalizeUIKeys(i);var n=this._configureTriggers(),r={};Object.assign(r,i,n),s(Object.getPrototypeOf(e.prototype),"delegateEvents",this).call(this,r)},writable:!0,configurable:!0},undelegateEvents:{value:function(){this.unbindUIElements(),s(Object.getPrototypeOf(e.prototype),"undelegateEvents",this).call(this)},writable:!0,configurable:!0},_configureTriggers:{value:function(){if(!this.triggers)return{};var t=this.normalizeUIKeys(p.result(this,"triggers")),e={},i=void 0,n=void 0;for(n in t)i=t[n],e[n]=this._buildViewTrigger(i);return e},writable:!0,configurable:!0},_buildViewTrigger:{value:function(t){"string"==typeof t&&(t={event:t});var e=Object.assign({preventDefault:!0,stopPropagation:!0},t);return function(t){t&&(t.preventDefault&&e.preventDefault&&t.preventDefault(),t.stopPropagation&&e.stopPropagation&&t.stopPropagation()),this.triggerMethod(e.event,{view:this,model:this.model,collection:this.collection})}},writable:!0,configurable:!0},bindUIElements:{value:function(){var t=this,e=this.getOption("ui");e&&(this._ui||(this._ui=e),e=r.utils.result(this,"_ui"),this.ui={},Object.keys(e).forEach(function(i){var n=t.$(e[i]);n&&n.length&&(n instanceof NodeList&&(n=n[0]),t.ui[i]=n)}),this.ui=this.ui)},writable:!0,configurable:!0},unbindUIElements:{value:function(){},writable:!0,configurable:!0},_renderTemplate:{value:function(t){var e=this.getOption("getTemplateData").call(this);return"function"==typeof t?p.callAsyncFunction(t,this,e):Promise.resolve(t)},writable:!0,configurable:!0},normalizeUIKeys:{value:function(t){var e=/@ui.([a-zA-Z_\-\$#]+)/i,i={},n=void 0,r=void 0,o=void 0,s=void 0,a=void 0;for(n in t)r=t[n],null!==(o=e.exec(n))&&(a=o[1],s=this._ui[a],null!=s&&(n=n.replace(o[0],s))),i[n]=r;return i},writable:!0,configurable:!0}}),e}(q);Object.assign(L.prototype,{getOption:p.getOption,triggerMethod:p.triggerMethod});var I=function(t){function e(t){u(this,e),this.options=t||{};var i=this.getOption("regions");this._regionManager=new j,p.proxy(this,this._regionManager,["removeRegion","removeRegions"]),this.regions=this._regionManager.regions,this.options=t||{},this.listenTo(this,"render",function(){this.addRegions(i)}),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return l(e,t),a(e,null,{addRegion:{value:function(t,e){if("string"==typeof e){var i=this.$(e);if(!i.length)throw new Error("element must exists in dom");e=new r.Region({el:i[0]})}this._regionManager.addRegion(t,e)},writable:!0,configurable:!0},addRegions:{value:function(t){for(var e in t)this.addRegion(e,t[e])},writable:!0,configurable:!0},destroy:{value:function(){s(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._regionManager.destroy()},writable:!0,configurable:!0}}),e}(L),D=function(t){function e(t){u(this,e),this.children=new y,this._isBuffering=!1,p.bindAll(this,["render"]),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.sort=!0,this.once("render",this._initCollectionEvents),this.listenTo(this,"show",function(){this.children.forEach(function(t){p.triggerMethodOn(t,"show")})})}return l(e,t),a(e,null,{render:{value:function(t){return this.destroyChildren(),this._destroyContainer(),this.listenToOnce(this,"render",function(){this._initContainer(),this.collection&&this._renderChildren(this.collection.models),"function"==typeof t&&t()}),s(Object.getPrototypeOf(e.prototype),"render",this).call(this)},writable:!0,configurable:!0},renderCollection:{value:function(){var t=this,e=void 0;this.trigger("before:render:children"),this.collection.models.forEach(function(i,n){e=t._getChildView(i),t._addChildView(e,n)}),this.trigger("render:children")},writable:!0,configurable:!0},renderChildView:{value:function(t,e){this.triggerMethod("before:render:child",t),t.render(),this._attachHTML(t,e),this.triggerMethod("render:child",t)},writable:!0,configurable:!0},removeChildView:{value:function(t){t&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.remove&&t.remove(),this.stopListening(t),this.children.remove(t),this._updateIndexes(t,!1))},writable:!0,configurable:!0},startBuffering:{value:function(){this._buffer=document.createDocumentFragment(),this._isBuffering=!0,this._bufferedChildren=[]},writable:!0,configurable:!0},stopBuffering:{value:function(){var t=this;this._isBuffering=!1,this._container.appendChild(this._buffer),this._bufferedChildren.forEach(function(e){t.children.add(e),t._isShown&&p.triggerMethodOn(e,"show")}),delete this._bufferedChildren},writable:!0,configurable:!0},_getChildView:{value:function(t){var e=this.getOption("childView")||r.View,i=this.getOption("childViewOptions")||{};return new e(Object.assign({model:t},i))},writable:!0,configurable:!0},_attachHTML:{value:function(t,e){this._isBuffering?(this._isShown&&p.triggerMethodOn(t,"before:show"),this._buffer.appendChild(t.el),this._bufferedChildren.push(t)):(this._isShown&&p.triggerMethodOn(t,"before:show"),this._insertBefore(t,e)||this._insertAfter(t),this._isShown&&p.triggerMethodOn(t,"show"))},writable:!0,configurable:!0},_renderChildren:{value:function(){this.destroyChildren(),0!==this.collection.length&&(this.startBuffering(),this.renderCollection(),this.stopBuffering())},writable:!0,configurable:!0},_addChildView:{value:function(t,e){this._updateIndexes(t,!0,e),this.proxyChildViewEvents(t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this._isBuffering&&p.triggerMethodOn(t,"show"),this.triggerMethod("add:child",t)},writable:!0,configurable:!0},proxyChildViewEvents:{value:function(t){var e="childview";this.listenTo(t,"all",function(){var i=g.call(arguments);i[0]=e+":"+i[0],i.splice(1,0,t),this.triggerMethod.apply(this,i)})},writable:!0,configurable:!0},resortView:{value:function(){var t=this;return this.triggerMethod("before:resort"),this.render(function(){t.triggerMethod("resort")}),this},writable:!0,configurable:!0},destroy:{value:function(){return this.triggerMethod("before:destroy:children"),this.destroyChildren(),this.triggerMethod("destroy:children"),s(Object.getPrototypeOf(e.prototype),"destroy",this).call(this)},writable:!0,configurable:!0},destroyChildren:{value:function(){this._container&&(this._container.innerHtml=""),this.children.forEach(this.removeChildView,this),this.children.empty()},writable:!0,configurable:!0},_insertBefore:{value:function(t,e){var i=void 0,n=this.sort&&e<this.children.length-1;return n&&(i=this.children.find(function(t){return t._index===e+1})),i?(this._container.insertBefore(t.el,i.el),!0):!1},writable:!0,configurable:!0},_insertAfter:{value:function(t){this._container.appendChild(t.el)},writable:!0,configurable:!0},_destroyContainer:{value:function(){this._container&&delete this._container},writable:!0,configurable:!0},_initCollectionEvents:{value:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._onCollectionSort))},writable:!0,configurable:!0},_initContainer:{value:function(){var t=this.getOption("childViewContainer");t=t?this.$(t)[0]:this.el,this._container=t},writable:!0,configurable:!0},_updateIndexes:{value:function(t,e,i){this.sort&&(e?(t._index=i,this.children.forEach(function(e){e._index>=t._index&&e._index++})):this.children.forEach(function(e){e._index>=t._index&&e._index--}))},writable:!0,configurable:!0},_onCollectionAdd:{value:function(t){var e=this._getChildView(t),i=this.collection.models.indexOf(t);this._addChildView(e,i)},writable:!0,configurable:!0},_onCollectionRemove:{value:function(t){var e=this.children.find(function(e){return e.model===t});this.removeChildView(e)},writable:!0,configurable:!0},_onCollectionSort:{value:function(){var t=this,e=this.collection.find(function(e,i){var n=t.children.find(function(t){return t.model===e});return!n||n._index!==i});e&&this.resortView()},writable:!0,configurable:!0}}),e}(L),F=function(e){function i(){var t=void 0===arguments[0]?{}:arguments[0];u(this,i),this.options=t;var e=this.getOption("regions");this._regionManager=new j,this._regionManager.extendObject(this),e&&this._regionManager.addRegions(e),this.channels={},this.channel("global").extendObject(this),"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}return l(i,e),a(i,null,{channel:{value:function n(t){if(this.channels[t])return this.channels[t];var n=new r.Channel(t);return this.channels[t]=n,n},writable:!0,configurable:!0},startHistory:{value:function(e){if(!this.isRunning)throw new Error("app not started");t.history&&(this.trigger("before:history:start",e),t.history.start(e),this.trigger("history:start",e))},writable:!0,configurable:!0},stopHistory:{value:function(){return t.history&&(this.trigger("before:history:stop"),t.history.stop(),this.trigger("history:stop")),this},writable:!0,configurable:!0},navigate:{value:function(e,i){t.history.navigate(e,i)},writable:!0,configurable:!0},currentFragment:{value:function(){return t.history.fragment},writable:!0,configurable:!0},destroy:{value:function(){s(Object.getPrototypeOf(i.prototype),"destroy",this).call(this),this.channels.forEach(function(t){t.destroy()}),delete this.channels,this._regionManager.unproxyObject(this),this._regionManager.destroy(),delete this._regionManager},writable:!0,configurable:!0}}),i}(E);return F.extend=L.extend=D.extend=I.extend=M.extend=j.extend=E.extend=b.extend=t.extend,t.ajax=v,Object.assign(r,{Application:F,Module:E,RegionManager:j,Region:M,LayoutView:I,View:L,CollectionView:D,Channel:x,List:y,Object:b,utils:p,NativeView:q}),r});