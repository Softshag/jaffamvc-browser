!function(t,e){if("function"==typeof define&&define.amd)define(["backbone"],e);else if("object"==typeof exports){var i=null;try{i=require("exoskeleton")}catch(n){}try{i=require("backbone")}catch(n){}module.exports=e(i)}else t.JaffaMVC=e(t.Exoskeleton||t.Backbone)}(this,function(t){"use strict";function e(){var t=void 0===arguments[0]?{}:arguments[0];if(!t.selector)throw new Error("No selector specified",t);return i(t.selector,t.regionClass||l.Region)}function i(t,e){var i=l.$(t);if(!i.length)throw new Error("Selector must exists in the dom");return new e({el:i[0]})}var n=function D(t,e,i){var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:D(r,e,i)}if("value"in n&&n.writable)return n.value;var o=n.get;return void 0===o?void 0:o.call(i)},r=function(t,e,i){e&&Object.defineProperties(t,e),i&&Object.defineProperties(t.prototype,i)},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},l={Events:t.Events,History:t.History,Model:t.Model,Collection:t.Collection,Router:t.Router},a=function(t){function e(){s(this,e),null!=t&&t.apply(this,arguments)}return o(e,t),e}(Error),u=function(t){function e(){s(this,e),null!=t&&t.apply(this,arguments)}return o(e,t),e}(a),h=function(){var t=[],e=void 0,i=document,n=i.documentElement.doScroll,r="DOMContentLoaded",o=(n?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return o||i.addEventListener(r,e=function(){for(i.removeEventListener(r,e),o=1;e=t.shift();)e()}),function(e){o?e():t.push(e)}}();l.$=function(t,e){return"function"==typeof t?h(t):(e=e||document,"string"!=typeof t&&"nodeType"in t?[t]:e.querySelectorAll(t))};var c=function(t){return t.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})},f=Array.prototype.slice,d={callFunction:function(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2]);case 4:return t.call(e,i[0],i[1],i[2],i[3]);default:return t.apply(e,i)}},callAsyncFunction:function(t,e,i){return new Promise(function(n,r){var o=void 0,s=void 0;if(o=function(t,e){return t?r(t):void n(e)},t.length>1)return t.call(e,i,o);if(d.isGenerator(t)||d.isGeneratorFunction(t)){if(!co||"function"!=typeof co.wrap)throw new Error("generators support needs co! - see https://github.com/tj/co");t=co.wrap(t)}try{s=t.call(e,i)}catch(l){s=l}s instanceof Error?r(s):s&&d.isPromise(s)?s.then(n,r):n(s)})},eachAsync:function(t,e,i){var n=0,r=t.length;return new Promise(function(o,s){var l=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(a){return null!=a||n===r?a?s(a):o():void d.callAsyncFunction(e,i,t[n++]).then(function(){l()},l)});l(null)})},bindAll:function(t,e){return d.proxy(t,t,e)},getOption:function(t){var e=this.options||{};return e[t]||this[t]},triggerMethod:function(t){var e=c("on-"+t.replace(/:/,"-")),i=d.getOption.call(this,e),n=f.call(arguments,1);d.callFunction(this.trigger,this,f.call(arguments)),"function"==typeof i&&d.callFunction(i,this,n)},triggerMethodOn:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];d.callFunction(d.triggerMethod,t,i)},proxy:function(t,e,i){Array.isArray(i)||(i=[i]),i.forEach(function(i){"function"==typeof e[i]&&(t[i]=e[i].bind(e))})},isGenerator:function(t){return"function"==typeof t.next&&"function"==typeof t["throw"]},isGeneratorFunction:function(t){var e=t.constructor;return e?"GeneratorFunction"===e.name||"GeneratorFunction"===e.displayName?!0:d.isGenerator(e.prototype):!1},isPromise:function(t){return"function"==typeof t.then},isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},result:function(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;i>r;r++)n[r-2]=arguments[r];return"function"==typeof t[e]?t[e].apply(t,n):t[e]}},g=function(){function t(){s(this,t),"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}return r(t,null,{destroy:{value:function(){for(var t=arguments.length,e=Array(t),i=0;t>i;i++)e[i]=arguments[i];if(!this.isDestroyed)return this.triggerMethod("before:destroy",e),this._isDestroyed=!0,this.triggerMethod("destroy",e),this.stopListening(),this},writable:!0,configurable:!0},isDestroyed:{get:function(){return null==this._isDestroyed&&(this._isDestroyed=!1),this._isDestroyed},configurable:!0}}),t}();Object.assign(g.prototype,t.Events,{getOption:d.getOption,triggerMethod:d.triggerMethod}),g.extend=t.extend;var v=function(){function t(){var e=void 0===arguments[0]?{}:arguments[0];s(this,t),this.options=e,this._items=[],this.length=0,this.onRemove=e.onRemove||this.onRemove,this.onAdd=e.onAdd||this.onAdd}return r(t,null,{has:{value:function(t){return~this._items.indexOf(t)},writable:!0,configurable:!0},add:{value:function(t){this.has(t)||(this._items.push(t),this._updateLength.call(this),this.onAdd&&this.onAdd(t))},writable:!0,configurable:!0},remove:{value:function(t){this.has(t)&&(this._items.splice(this._items.indexOf(t),1),this._updateLength.call(this),this.onRemove&&this.onRemove(t))},writable:!0,configurable:!0},empty:{value:function(){this.forEach(this.remove,this),this._items=[],this._updateLength.call(this)},writable:!0,configurable:!0},find:{value:function(t,e){for(var i=void 0,n=0;n<this._items.length;n++)if(i=this._items[n],t.call(e,i)===!0)return i;return null},writable:!0,configurable:!0},forEach:{value:function(t,e){return this._items.forEach(t,e)},writable:!0,configurable:!0},_updateLength:{value:function(){this.length=this._items.length},writable:!0,configurable:!0}}),t}(),b=function(){function t(){s(this,t),this._phases=[],this._initialized=!1}return r(t,null,{phase:{value:function(t,e,i){"function"==typeof t&&(e=t,t=e.name||"unamed");var n={n:t,fn:e,ctx:i||this};return this._phases.push(n),this.isInitialized&&this._runPhase(n),this},writable:!0,configurable:!0},boot:{value:function(t){var e=this;if(this.isInitialized)throw new u("already initalized");var i=this._phases;return d.eachAsync(i,function(i){return e._runPhase(i,t)}).then(function(){e._initialized=!0})},writable:!0,configurable:!0},reset:{value:function(){return this._initialized=!1,this},writable:!0,configurable:!0},_runPhase:{value:function(t,e){return d.callAsyncFunction(t.fn,t.ctx,e)},writable:!0,configurable:!0},isInitialized:{get:function(){return this._initialized},configurable:!0}}),t}(),p=function(t){function e(){s(this,e),null!=t&&t.apply(this,arguments)}return o(e,t),e}(a),m={comply:function(t,e,i){this._cmds=this._cmds||{},this._cmds[t]={fn:e,ctx:i||this}},command:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),n=1;e>n;n++)i[n-1]=arguments[n];if(this._cmds=this._cmds||{},!this._cmds.hasOwnProperty(t))throw new p("no handler for command: ",t);var r=this._cmds[t],o=r.fn,s=r.ctx;d.callFunction(o,s,i)},stopComplying:function(t,e,i){this._cmds=this._cmds||{},i=i||this,delete this._cmds[t]}},y={reply:function(t,e,i){this._reqs=this._reqs||{},this._reqs[t]={fn:e,ctx:i||this}},request:function(t){if(this._reqs=this._reqs||{},this._reqs.hasOwnProperty(t)){{var e=this._reqs[t],i=e.fn;e.ctx}(d.isGenerator(i)||d.isGeneratorFunction(i))&&(i=co.wrap(i));var n=i.apply(t.ctx,f.call(arguments,1));return d.isPromise(n)?n:n=n instanceof Error?Promise.reject(n):Promise.resolve(n)}return Promise.reject(new p("no handler for request: "+t))},stopReplying:function(t,e,i){this._reqs=this._reqs||{},i=i||this,delete this._reqs[t]}},w=function(t){function e(t){s(this,e),this._name=t}return o(e,t),r(e,{Commands:{get:function(){return m},configurable:!0},Requests:{get:function(){return y},configurable:!0}},{extendObject:{value:function(t){l.utils.proxy(t,this,["comply","command","stopComplying","reply","request","stopReplying"])},writable:!0,configurable:!0}}),e}(g);Object.assign(w.prototype,m,y);var _=function(t){function e(t,i,r){s(this,e),Object.assign(this,{options:i,name:t,app:r}),n(Object.getPrototypeOf(e.prototype),"constructor",this).call(this)}return o(e,t),r(e,null,{startWithParent:{get:function(){return null==this._startWithParent&&(this._startWithParent=!0),this._startWithParent},set:function(t){this._startWithParent=t},configurable:!0},addInitializer:{value:function(t,e,i){this.initializer.phase(t,e,i||this)},writable:!0,configurable:!0},addFinalizer:{value:function(t,e,i){this.finalizer.phase(t,e,i||this)},writable:!0,configurable:!0},start:{value:function(t){var e=this;return this.initializer.isInitialized?Promise.resolve():(this.triggerMethod("before:start",t),this.initializer.boot(t).then(function(){return e._startSubmodules()}).then(function(){e.triggerMethod("start",t)}))},writable:!0,configurable:!0},stop:{value:function(t){var e=this;return this.isRunning?(this.triggerMethod("before:stop",t),this.finalizer.boot(t).then(function(){return e._stopSubmodules(t)}).then(function(){e.initializer.reset(),e.finalizer.reset(),e.triggerMethod("stop",t)})):Promise.resolve()},writable:!0,configurable:!0},module:{value:function(t,i){var n=void 0===arguments[2]?{}:arguments[2];if(null==i)return this.modules[t];if(this.modules.hasOwnProperty(t))throw new Error("Module already defined "+t);var r=i;return"function"!=typeof i&&(r=e.extend(i)),this.modules[t]=new r(t,n,this.app||this),this.modules[t]},writable:!0,configurable:!0},removeModule:{value:function(t){var e=this.module(t);e&&e.stop().then(function(){e.destroy()})},writable:!0,configurable:!0},removeAllModules:{value:function(){for(var t in this.modules)this.removeModule(t)},writable:!0,configurable:!0},initializer:{get:function(){return this._initializer||(this._initializer=new b),this._initializer},configurable:!0},finalizer:{get:function(){return this._finalizer||(this._finalizer=new b),this._finalizer},configurable:!0},modules:{get:function(){return null==this._modules&&(this._modules=[]),this._modules},configurable:!0},isRunning:{get:function(){return this.initializer.isInitialized&&!this.finalizer.isInitialized},configurable:!0},_startSubmodules:{value:function(t){var e=this;return d.eachAsync(Object.keys(this.modules),function(i){var n=e.modules[i];return n.startWithParent?n.start(t):void 0})},writable:!0,configurable:!0},_stopSubmodules:{value:function(){return d.eachAsync(this.modules,function(t){return t.stop()})},writable:!0,configurable:!0}}),e}(g),O=function(t){function l(){var t=void 0===arguments[0]?{}:arguments[0];s(this,l),this.options=t,this.el=this.getOption("el"),n(Object.getPrototypeOf(l.prototype),"constructor",this).call(this)}return o(l,t),r(l,{buildRegion:{value:function(t){return t instanceof l?t:"string"==typeof t?i(t,l):e(t)},writable:!0,configurable:!0}},{show:{value:function(t){var e=t!==this.currentView;return this.empty(),e&&(t.once("destroy",this.empty,this),t.render(),d.triggerMethodOn(t,"before:show"),this._attachHtml(t),this.currentView=t,d.triggerMethodOn(t,"show")),this},writable:!0,configurable:!0},destroy:{value:function(){this.empty(),this.stopListening()},writable:!0,configurable:!0},empty:{value:function(){if(this.currentView){var t=this.currentView;return t.off("destroy",this.empty,this),this.trigger("before:empty",t),this._destroyView(),this.trigger("empty",t),delete this.currentView,this}},writable:!0,configurable:!0},_attachHtml:{value:function(t){this.el.innerHtml="",this.el.appendChild(t.el)},writable:!0,configurable:!0},_destroyView:{value:function(){var t=this.currentView;t.destroy&&"function"==typeof t.destroy&&!t.isDestroyed?t.destroy():t.remove&&"function"==typeof t.remove&&t.remove()},writable:!0,configurable:!0}}),l}(g),E=["addRegions","addRegion","removeRegion","removeRegions"],M=function(t){function e(){s(this,e),this.regions={},n(Object.getPrototypeOf(e.prototype),"constructor",this).call(this)}return o(e,t),r(e,null,{extendObject:{value:function(t){d.proxy(t,this,E),t.regions=this.regions},writable:!0,configurable:!0},unproxyObject:{value:function(t){E.forEach(function(e){t[e]&&delete t[e]})},writable:!0,configurable:!0},addRegions:{value:function(t){var e=void 0,i={},n=Object.keys(t);return n.forEach(function(n){e=t[n],i[n]=this.addRegion(n,e)},this),i},writable:!0,configurable:!0},addRegion:{value:function(t,e){var i=l.Region.buildRegion(e);return this._setRegion(t,i),i},writable:!0,configurable:!0},removeRegion:{value:function(){var t=f.call(arguments);t.forEach(function(t){if(__has.call(this.regions,t)){var e=this.regions[t];e.destroy(),this._unsetRegion(t)}},this)},writable:!0,configurable:!0},destroy:{value:function(){n(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.removeRegions()},writable:!0,configurable:!0},removeRegions:{value:function(){this.removeRegion.apply(this,Object.keys(this.regions))},writable:!0,configurable:!0},_setRegion:{value:function(t,e){this.regions[t]=e},writable:!0,configurable:!0},_unsetRegion:{value:function(t){delete this.regions[t]},writable:!0,configurable:!0}}),e}(g),x=/^\s*</,C="undefined"!=typeof Element&&Element.prototype||{},R=C.addEventListener||function(t,e){return this.attachEvent("on"+t,e)},P=C.removeEventListener||function(t,e){return this.detachEvent("on"+t,e)},j=function(t,e){for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},z=C.matches||C.webkitMatchesSelector||C.mozMatchesSelector||C.msMatchesSelector||C.oMatchesSelector||function(t){var e=(this.parentNode||document).querySelectorAll(t)||[];return!!~j(e,this)},V=t.View,A=function(t){function e(){for(var t=arguments.length,i=Array(t),r=0;t>r;r++)i[r]=arguments[r];s(this,e),this._domEvents=[],n(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,i)}return o(e,t),r(e,null,{$:{value:function(t){return l.$(t,this.el)},writable:!0,configurable:!0},_removeElement:{value:function(){this.undelegateEvents(),this.el.parentNode&&this.el.parentNode.removeChild(this.el)},writable:!0,configurable:!0},_setElement:{value:function(t){if("string"==typeof t)if(x.test(t)){var e=document.createElement("div");e.innerHTML=t,this.el=e.firstChild}else this.el=document.querySelector(t);else this.el=t;this.$el=l.$(this.el)},writable:!0,configurable:!0},_setAttributes:{value:function(t){for(var e in t)e in this.el?this.el[e]=t[e]:this.el.setAttribute(e,t[e])},writable:!0,configurable:!0},delegate:{value:function(t,e,i){"function"==typeof e&&(i=e,e=null);var n=this.el,r=e?function(t){for(var r=t.target||t.srcElement;r&&r!=n;r=r.parentNode)z.call(r,e)&&(t.delegateTarget=r,i(t))}:i;return R.call(this.el,t,r,!1),this._domEvents.push({eventName:t,handler:r,listener:i,selector:e}),r},writable:!0,configurable:!0},undelegate:{value:function(t,e,i){if("function"==typeof e&&(i=e,e=null),this.el)for(var n=this._domEvents.slice(),r=0,o=n.length;o>r;r++){var s=n[r],l=s.eventName===t&&(i?s.listener===i:!0)&&(e?s.selector===e:!0);l&&(P.call(this.el,s.eventName,s.handler,!1),this._domEvents.splice(j(n,s),1))}return this},writable:!0,configurable:!0},undelegateEvents:{value:function(){if(this.el){for(var t=0,e=this._domEvents.length;e>t;t++){var i=this._domEvents[t];P.call(this.el,i.eventName,i.handler,!1)}this._domEvents.length=0}return this},writable:!0,configurable:!0}}),e}(V),S=function(t){function e(t){s(this,e),this.options=t||{},this.isDestroyed=!1,this.listenTo(this,"show",function(){this._isShown=!0}),this.listenTo(this,"render",function(){this._isRendered=!0}),n(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return o(e,t),r(e,null,{destroy:{value:function(){if(this.isDestroyed===!0)return this;var t=f.call(arguments);return this.triggerMethod("before:destroy",t),this.isDestroyed=!0,this.triggerMethod("destroy",t),this.remove(),this},writable:!0,configurable:!0},render:{value:function(){var t=this;this.triggerMethod("before:render",this),this.undelegateEvents();var e=this.getOption("template");return e?this._renderTemplate(e).then(function(e){t.el.innerHTML=e,t.delegateEvents(),t.triggerMethod("render",t)}):(this.delegateEvents(),this.triggerMethod("render",this)),this},writable:!0,configurable:!0},getTemplateData:{value:function(){return this.model?this.model.toJSON():{}},writable:!0,configurable:!0},delegateEvents:{value:function(t){this.bindUIElements();var i=t||this.events;i=this.normalizeUIKeys(i);var r=this._configureTriggers(),o={};Object.assign(o,i,r),n(Object.getPrototypeOf(e.prototype),"delegateEvents",this).call(this,o)},writable:!0,configurable:!0},undelegateEvents:{value:function(){this.unbindUIElements(),n(Object.getPrototypeOf(e.prototype),"undelegateEvents",this).call(this)},writable:!0,configurable:!0},_configureTriggers:{value:function(){if(!this.triggers)return{};var t=this.normalizeUIKeys(d.result(this,"triggers")),e={},i=void 0,n=void 0;for(n in t)i=t[n],e[n]=this._buildViewTrigger(i);return e},writable:!0,configurable:!0},_buildViewTrigger:{value:function(t){"string"==typeof t&&(t={event:t});var e=Object.assign({preventDefault:!0,stopPropagation:!0},t);return function(t){t&&(t.preventDefault&&e.preventDefault&&t.preventDefault(),t.stopPropagation&&e.stopPropagation&&t.stopPropagation()),this.triggerMethod(e.event,{view:this,model:this.model,collection:this.collection})}},writable:!0,configurable:!0},bindUIElements:{value:function(){var t=this,e=this.getOption("ui");e&&(this._ui||(this._ui=e),e=l.utils.result(this,"_ui"),this.ui={},Object.keys(e).forEach(function(i){var n=t.$(e[i]);n&&n.length&&(n instanceof NodeList&&(n=n[0]),t.ui[i]=n)}),this.ui=this.ui)},writable:!0,configurable:!0},unbindUIElements:{value:function(){},writable:!0,configurable:!0},_renderTemplate:{value:function(t){var e=this.getOption("getTemplateData").call(this);return"function"==typeof t?d.callAsyncFunction(t,this,e):Promise.resolve(t)},writable:!0,configurable:!0},normalizeUIKeys:{value:function(t){var e=/@ui.([a-zA-Z_\-\$#]+)/i,i={},n=void 0,r=void 0,o=void 0,s=void 0,l=void 0;for(n in t)r=t[n],null!==(o=e.exec(n))&&(l=o[1],s=this._ui[l],null!=s&&(n=n.replace(o[0],s))),i[n]=r;return i},writable:!0,configurable:!0}}),e}(A);Object.assign(S.prototype,{getOption:d.getOption,triggerMethod:d.triggerMethod});var T=function(t){function e(t){s(this,e),this.options=t||{};var i=this.getOption("regions");this._regionManager=new l.RegionManager,d.proxy(this,this._regionManager,["removeRegion","removeRegions"]),this.regions=this._regionManager.regions,this.options=t||{},this.listenTo(this,"render",function(){this.addRegions(i)}),n(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return o(e,t),r(e,null,{addRegion:{value:function(t,e){if("string"==typeof e){var i=this.$(e);if(!i.length)throw new Error("element must exists in dom");e=new l.Region({el:i[0]})}this._regionManager.addRegion(t,e)},writable:!0,configurable:!0},addRegions:{value:function(t){for(var e in t)this.addRegion(e,t[e])},writable:!0,configurable:!0},destroy:{value:function(){n(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._regionManager.destroy()},writable:!0,configurable:!0}}),e}(S),L=function(t){function e(t){s(this,e),this.children=new l.List,this._isBuffering=!1,d.bindAll(this,["render"]),n(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.sort=!0,this.once("render",this._initCollectionEvents),this.listenTo(this,"show",function(){this.children.forEach(function(t){d.triggerMethodOn(t,"show")})})}return o(e,t),r(e,null,{render:{value:function(t){return this.destroyChildren(),this._destroyContainer(),this.listenToOnce(this,"render",function(){this._initContainer(),this.collection&&this._renderChildren(this.collection.models),"function"==typeof t&&t()}),n(Object.getPrototypeOf(e.prototype),"render",this).call(this)},writable:!0,configurable:!0},renderCollection:{value:function(){var t=this,e=void 0;this.trigger("before:render:children"),this.collection.models.forEach(function(i,n){e=t._getChildView(i),t._addChildView(e,n)}),this.trigger("render:children")},writable:!0,configurable:!0},renderChildView:{value:function(t,e){this.triggerMethod("before:render:child",t),t.render(),this._attachHTML(t,e),this.triggerMethod("render:child",t)},writable:!0,configurable:!0},removeChildView:{value:function(t){t&&("function"==typeof t.destroy?t.destroy():"function"==typeof t.remove&&t.remove(),this.stopListening(t),this.children.remove(t),this._updateIndexes(t,!1))},writable:!0,configurable:!0},startBuffering:{value:function(){this._buffer=document.createDocumentFragment(),this._isBuffering=!0,this._bufferedChildren=[]},writable:!0,configurable:!0},stopBuffering:{value:function(){var t=this;this._isBuffering=!1,this._container.appendChild(this._buffer),this._bufferedChildren.forEach(function(e){t.children.add(e),t._isShown&&d.triggerMethodOn(e,"show")}),delete this._bufferedChildren},writable:!0,configurable:!0},_getChildView:{value:function(t){var e=this.getOption("childView")||l.View,i=this.getOption("childViewOptions")||{};return new e(Object.assign({model:t},i))},writable:!0,configurable:!0},_attachHTML:{value:function(t,e){this._isBuffering?(this._isShown&&d.triggerMethodOn(t,"before:show"),this._buffer.appendChild(t.el),this._bufferedChildren.push(t)):(this._isShown&&d.triggerMethodOn(t,"before:show"),this._insertBefore(t,e)||this._insertAfter(t),this._isShown&&d.triggerMethodOn(t,"show"))},writable:!0,configurable:!0},_renderChildren:{value:function(){this.destroyChildren(),0===this.collection.length||(this.startBuffering(),this.renderCollection(),this.stopBuffering())},writable:!0,configurable:!0},_addChildView:{value:function(t,e){this._updateIndexes(t,!0,e),this.proxyChildViewEvents(t),this.children.add(t),this.renderChildView(t,e),this._isShown&&!this._isBuffering&&d.triggerMethodOn(t,"show"),this.triggerMethod("add:child",t)},writable:!0,configurable:!0},proxyChildViewEvents:{value:function(t){var e="childview";this.listenTo(t,"all",function(){var i=f.call(arguments);i[0]=e+":"+i[0],i.splice(1,0,t),this.triggerMethod.apply(this,i)})},writable:!0,configurable:!0},resortView:{value:function(){var t=this;return this.triggerMethod("before:resort"),this.render(function(){t.triggerMethod("resort")}),this},writable:!0,configurable:!0},destroy:{value:function(){return this.triggerMethod("before:destroy:children"),this.destroyChildren(),this.triggerMethod("destroy:children"),n(Object.getPrototypeOf(e.prototype),"destroy",this).call(this)},writable:!0,configurable:!0},destroyChildren:{value:function(){this._container&&(this._container.innerHtml=""),this.children.forEach(this.removeChildView,this),this.children.empty()},writable:!0,configurable:!0},_insertBefore:{value:function(t,e){var i=void 0,n=this.sort&&e<this.children.length-1;return n&&(i=this.children.find(function(t){return t._index===e+1})),i?(this._container.insertBefore(t.el,i.el),!0):!1},writable:!0,configurable:!0},_insertAfter:{value:function(t){this._container.appendChild(t.el)},writable:!0,configurable:!0},_destroyContainer:{value:function(){this._container&&delete this._container},writable:!0,configurable:!0},_initCollectionEvents:{value:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._onCollectionSort))},writable:!0,configurable:!0},_initContainer:{value:function(){var t=this.getOption("childViewContainer");t=t?this.$(t)[0]:this.el,this._container=t},writable:!0,configurable:!0},_updateIndexes:{value:function(t,e,i){this.sort&&(e?(t._index=i,this.children.forEach(function(e){e._index>=t._index&&e._index++})):this.children.forEach(function(e){e._index>=t._index&&e._index--}))},writable:!0,configurable:!0},_onCollectionAdd:{value:function(t){var e=this._getChildView(t),i=this.collection.models.indexOf(t);this._addChildView(e,i)},writable:!0,configurable:!0},_onCollectionRemove:{value:function(t){var e=this.children.find(function(e){return e.model===t});this.removeChildView(e)},writable:!0,configurable:!0},_onCollectionSort:{value:function(){var t=this,e=this.collection.find(function(e,i){var n=t.children.find(function(t){return t.model===e});return!n||n._index!==i});e&&this.resortView()},writable:!0,configurable:!0}}),e}(S),q=function(e){function i(){var t=void 0===arguments[0]?{}:arguments[0];s(this,i),this.options=t;var e=this.getOption("regions");this._regionManager=new M,this._regionManager.extendObject(this),e&&this._regionManager.addRegions(e),this.channels={},this.channel("global").extendObject(this),"function"==typeof this.initialize&&this.initialize.apply(this,arguments)}return o(i,e),r(i,null,{channel:{value:function a(t){if(this.channels[t])return this.channels[t];var a=new l.Channel(t);return this.channels[t]=a,a},writable:!0,configurable:!0},startHistory:{value:function(e){if(!this.isRunning)throw new Error("app not started");t.history&&(this.trigger("before:history:start",e),t.history.start(e),this.trigger("history:start",e))},writable:!0,configurable:!0},stopHistory:{value:function(){return t.history&&(this.trigger("before:history:stop"),t.history.stop(),this.trigger("history:stop")),this},writable:!0,configurable:!0},navigate:{value:function(e,i){t.history.navigate(e,i)},writable:!0,configurable:!0},currentFragment:{value:function(){return t.history.fragment},writable:!0,configurable:!0},destroy:{value:function(){n(Object.getPrototypeOf(i.prototype),"destroy",this).call(this),this.channels.forEach(function(t){t.destroy()}),delete this.channels,this._regionManager.unproxyObject(this),this._regionManager.destroy(),delete this._regionManager},writable:!0,configurable:!0}}),i}(_);return q.extend=t.extend,S.extend=t.extend,L.extend=t.extend,T.extend=t.extend,O.extend=t.extend,M.extend=t.extend,_.extend=t.extend,g.extend=t.extend,Object.assign(l,{Application:q,Module:_,RegionManager:M,Region:O,LayoutView:T,View:S,CollectionView:L,Channel:w,List:v,Object:g,utils:d,NativeView:A}),l});